#!/bin/bash
# Script used for starting/stopping mysql

SCRIPT_DESC="Script used for starting/stopping mysql"
commons_dir="/usr/local/bin/common"

MYSQL_LOCATION="/etc/init.disabled/mysql"

# Include common functions
. ${commons_dir}/common.sh

# Include root functions
. ${commons_dir}/sudoUtil.sh

function printHelpAndExit {
    echo "USAGE"
    echo "  ${SCRIPT_NAME} [--start | --stop | --help]"
    echo
    echo "DESCRIPTION"
    echo "  ${SCRIPT_DESC}"
    echo
    echo "OPTIONS"
    echo "  --start,  --s         : Select start action (default)"
    echo "  --stop,   --x         : Select stop action"
    echo "  --status, --c         : Select stop action"
    echo
    echo "  --help,   --h         : Show this help"
    exit 1
}

function startMysql {
    runAsSudo "${MYSQL_LOCATION} start"
}

function stopMysql {
    runAsSudo "${MYSQL_LOCATION} stop"
}

function statusMysql {
    processNum=$(runAsSudo "ps aux | grep "mysql" | wc -l")
    if [ $processNum -lt 6 ]; then 
        logInfo "*** STATUS: NOT RUNNING"
    else
        logInfo "*** STATUS: RUNNING"
    fi
}

ACTION=""

# Parsing command line arguments
for arg; do
    case "${arg}" in
        --start|--s)
            ACTION="startMysql"
        ;;
        --stop|--x)
            ACTION="stopMysql"
        ;;
        --status|--c)
            ACTION=""
        ;;
        --help)
            printHelpAndExit
        ;;
    esac
done

logInfo "ACTION: ${ACTION}"

eval ${ACTION}

statusMysql

# END