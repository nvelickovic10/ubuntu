#!/bin/bash
# ------------------------------------------------
# Description: Tools for the aws console
#
# Author: nvelickovic10
# Creation date: Feb 27. 2018.

# INSTANCE_GRID_TAG=NV USE_SELENIUM_GRID=true CONF_FILE=conf-dev42.js ./localBuild.sh --tags=@Devl
# ------------------------------------------------

SCRIPT_NAME="${0##*/}"
SCRIPT_DESC="Tools for the AWS console"

function printHelpAndExit {
    echo "USAGE"
    echo "  ${SCRIPT_NAME} [--login | --list-profiles | --delete-profile [PROFILE_NAME] | --help]"
    echo
    echo "DESCRIPTION"
    echo "  ${SCRIPT_DESC}"
    echo
    echo "OPTIONS"
    echo "  --login         : Login to the AWS console"
    echo
    echo "  --list-profiles, --ls           : List instance profiles"
    echo "  --delete-profile [PROFILE_NAME] : Delete instance profile"
    echo "  --help,   --h         : Show this help"
    exit 1
}

# Parsing command line arguments
for arg; do
    case "${arg}" in
        --login)
            ACTION="LOGIN"
            
            AWS_COMMAND="/home/nvelickovic10/Workspace/LocalWorkspace/AWS-console/target/linux/console"
            
            echo "AWS_COMMAND: ${AWS_COMMAND}"
            eval ${AWS_COMMAND}
            
            exit 0
            
            shift
        ;;
        --list-profiles|--ls)
            ACTION="LIST_PROFILES"
            
            AWS_COMMAND="aws --profile tm-intl-dev-Ops-Techops iam list-instance-profiles --query 'InstanceProfiles[].InstanceProfileName' --output table | egrep 'prd926|---'
"
            echo "AWS_COMMAND: ${AWS_COMMAND}"
            eval ${AWS_COMMAND}
            
            exit 0
            
            shift
        ;;
        --delete-profile)
            ACTION="DELETE_PROFILE"
            PROFILE_NAME=${2}
            
            AWS_COMMAND="aws --profile tm-intl-dev-Ops-Techops iam delete-instance-profile --instance-profile-name ${PROFILE_NAME}"
            echo "AWS_COMMAND: ${AWS_COMMAND}"
            eval ${AWS_COMMAND}
            
            exit 0
            
            shift
            shift
        ;;
        --help)
            printHelpAndExit
        ;;
    esac
done
